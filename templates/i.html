<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeqNexus | Genomic Similarity Analysis</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-bg: #0B1120; --light-text: #F9FAFB; --medium-text: #9CA3AF;
            --card-bg: #191E38; --success-bg: #059669; --error-bg: #DC2626; 
            --border-color: rgba(255, 255, 255, 0.1);
            --accent-gradient: linear-gradient(45deg, #feda75, #fa7e1e, #d62976, #962fbf, #4f5bd5);
            --accent-magenta: #d62976;
            --base-a: #4ade80; /* Green */ --base-t: #60a5fa; /* Blue */
            --base-c: #facc15; /* Yellow */ --base-g: #f87171; /* Red */
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--dark-bg);
            color: var(--light-text); 
            line-height: 1.6;
            overflow-x: hidden;
            padding-top: 70px; 
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 0 20px; z-index: 10; position: relative; }
        section { padding: 100px 0; }
        h1 { font-size: 3.8rem; line-height: 1.1; letter-spacing: -0.02em; }
        h2 { font-size: 2.5rem; text-align: center; margin-bottom: 50px; }
        h3 { font-size: 1.25rem; margin-bottom: 10px; color: var(--light-text); }
        p { color: var(--medium-text); }
        .btn { display: inline-block; padding: 12px 28px; border-radius: 8px; text-decoration: none; font-weight: 600; cursor: pointer; border: none; transition: all 0.3s ease; }
        .btn-primary { 
            background-image: var(--accent-gradient);
            background-size: 200% auto;
            color: white; 
            box-shadow: 0 4px 14px 0 rgba(214, 41, 118, 0.3);
        }
        .btn:hover { 
            transform: translateY(-3px); 
            background-position: right center;
            box-shadow: 0 6px 20px 0 rgba(214, 41, 118, 0.4); 
        }
        .header { 
            position: fixed; top: 0; left: 0; width: 100%;
            display: flex; justify-content: center;
            padding: 15px 0; z-index: 1000;
            transition: background-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .header-content {
            width: 100%; max-width: 1000px; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header.scrolled {
            background-color: rgba(11, 17, 32, 0.8);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .logo { display: flex; align-items: center; gap: 10px; font-size: 1.5rem; font-weight: 700; text-decoration: none; color: var(--light-text); }
        .nav a { color: var(--medium-text); text-decoration: none; margin-left: 24px; transition: color 0.3s ease; }
        
        .hero {
            height: calc(100vh - 70px);
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; text-align: center; position: relative;
            padding-top: 0;
            background: radial-gradient(circle at 15% 25%, rgba(214, 41, 118, 0.1), transparent 30%),
                        radial-gradient(circle at 85% 75%, rgba(79, 91, 213, 0.1), transparent 25%);
        }
        .hero-text-content { z-index: 10; }
        .hero-animation-container { width: 800px; height: 200px; position: relative; margin-top: 40px; }
        .strand-element { position: absolute; height: 25px; display: flex; justify-content: center; align-items: center; opacity: 0; left: 50%; top: 50%; }
        .hero.start-assembly .strand-element { animation: assemble 2s ease-out forwards, oscillate 4s ease-in-out 2.5s infinite; animation-delay: var(--delay); }
        @keyframes assemble {
            0% { opacity: 0; transform: translateX(var(--start-x)) translateY(var(--y-pos)); }
            100% { opacity: 1; transform: translateX(var(--end-x)) translateY(var(--y-pos)); }
        }
        @keyframes oscillate {
            0%, 100% { transform: translateX(var(--end-x)) translateY(var(--y-pos)); }
            50% { transform: translateX(var(--end-x)) translateY(calc(var(--y-pos) + var(--y-oscillation))); }
        }
        .base { width: 25px; height: 25px; border-radius: 6px; display: flex; justify-content: center; align-items: center; font-size: 14px; font-weight: bold; color: var(--dark-bg); }
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .property-circle-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .property-circle {
            position: absolute; width: 180px; height: 180px;
            border-radius: 50%; background-color: rgba(25, 30, 56, 0.8);
            border: 1px solid var(--border-color);
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
            backdrop-filter: blur(5px); opacity: 0; transform: scale(0.8);
            transition: all 0.4s ease-out; padding: 15px;
        }
        .property-circle:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(214, 41, 118, 0.5); border-color: var(--accent-magenta); }
        .property-circle svg { margin-bottom: 8px; color: var(--accent-magenta); width: 28px; height: 28px; }
        .property-circle h3 { font-size: 1.1rem; line-height: 1.2; margin-bottom: 4px; }
        .property-circle p { font-size: 0.8rem; line-height: 1.4; }
        .hero.show-properties .property-circle { opacity: 1; transform: scale(1); }
        #prop-1 { top: 20%; left: 15%; transition-delay: 0s; } #prop-2 { bottom: 20%; left: 15%; transition-delay: 0.2s; }
        #prop-3 { top: 20%; right: 15%; transition-delay: 0.1s; } #prop-4 { bottom: 20%; right: 15%; transition-delay: 0.3s; }
        
        .features-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; }
        .feature-card { background-color: var(--card-bg); padding: 30px; border-radius: 12px; border: 1px solid var(--border-color); transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .feature-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.3), 0 0 25px rgba(214, 41, 118, 0.4); border-color: rgba(214, 41, 118, 0.8); }
        .feature-card svg { margin-bottom: 20px; color: var(--accent-magenta); }
        .transition-divider { margin: -1px 0; line-height: 0;}
        
        #tool { padding: 100px 0; background-color: #0c121c; }
        .tool-layout { display: grid; grid-template-columns: 300px 1fr; gap: 50px; align-items: start; }
        .tool-sidebar { background-color: var(--card-bg); padding: 30px; border-radius: 16px; border: 1px solid var(--border-color); position: sticky; top: 100px; }
        .tool-sidebar h3 { font-size: 1.5rem; margin-bottom: 30px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        .tool-main-content { min-height: 500px; min-width: 0; }
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; }
        input[type="file"]::file-selector-button { background-image: var(--accent-gradient); background-size: 200% auto; color: white; border: none; padding: 10px 15px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .analyze-button-wrapper { text-align: center; margin-top: 30px; }
        .placeholder-text { color: var(--medium-text); text-align: center; margin-top: 50px; border: 2px dashed var(--border-color); padding: 40px; border-radius: 12px;}
        
        #loader-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-color: rgba(11, 17, 32, 0.9); z-index: 1000; 
            display: none; justify-content: center; align-items: center; 
            backdrop-filter: blur(5px);
            flex-direction: column;
        }

        .table-container { overflow-x: auto; margin-bottom: 30px; }
        .results-table { border-collapse: collapse; font-size: 0.9rem; white-space: nowrap; }
        .results-table th, .results-table td { border: 1px solid var(--border-color); padding: 10px 12px; text-align: left; }
        .results-table th { background-color: var(--card-bg); font-weight: 600; }
        .download-links-container { padding: 20px; background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; }
        .download-links-container h3 { margin-top: 0; }
        .download-links-container a { display: inline-block; margin-right: 20px; color: var(--accent-magenta); text-decoration: none; font-weight: 600; }
        .download-links-container a:hover { text-decoration: underline; }

        .loader-animation-container {
            width: 100%;
            height: 150px;
            position: relative;
            overflow: hidden;
        }
        .data-stream {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 100px;
            transform: translateY(-50%);
            background-image: linear-gradient(90deg, 
                rgba(214, 41, 118, 0), 
                rgba(214, 41, 118, 0.3) 20%, 
                rgba(214, 41, 118, 0.3) 80%, 
                rgba(214, 41, 118, 0) 100%);
            filter: blur(3px);
            animation: pulse 2s ease-in-out infinite;
        }
        .particle {
            position: absolute;
            left: -50px;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
            animation: flow 5s linear;
        }
        .particle.base {
            font-size: 2rem;
        }
        .particle.cell {
            font-size: 2rem; 
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .base-a { color: var(--base-a); }
        .base-t { color: var(--base-t); }
        .base-c { color: var(--base-c); }
        .base-g { color: var(--base-g); }
        .cell-red { background-color: #ef4444; color: #fecaca; }
        .cell-neuron { color: #818cf8; }

        .loading-text {
            margin-top: 30px;
            font-size: 1.1rem;
            color: var(--medium-text);
            letter-spacing: 1px;
        }
        @keyframes flow {
            0% { left: -50px; transform: rotate(0deg) translateY(0px); }
            50% { transform: rotate(90deg) translateY(5px); }
            100% { left: 105%; transform: rotate(180deg) translateY(-5px); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.8; box-shadow: 0 0 15px rgba(214, 41, 118, 0.3); }
            50% { opacity: 1; box-shadow: 0 0 25px rgba(214, 41, 118, 0.5); }
        }
    </style>
</head>
<body>
    <div id="loader-overlay">
        <div id="animation-container" class="loader-animation-container">
            <div class="data-stream"></div>
        </div>
        <p class="loading-text">Processing DNA sequences...</p>
    </div>

    <header class="header" id="main-header">
         <div class="header-content">
            <a href="#" class="logo"><svg width="32" height="32" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><style>.s1{fill:none;stroke:#d62976;stroke-width:8;stroke-linecap:round;}.s2{fill:none;stroke:#4f5bd5;stroke-width:8;stroke-linecap:round;}</style><path class="s1" d="M25 10 C 75 40, 25 60, 75 90" /><path class="s2" d="M75 10 C 25 40, 75 60, 25 90" /></svg> SeqNexus</a>
            <nav class="nav">
                <a href="#features">Features</a>
                <a href="#tool">Tool</a>
                <a href="https://github.com" target="_blank">GitHub</a>
                <a href="#tool" class="btn btn-primary">Launch</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="hero-text-content"><h1>SeqNexus</h1><p style="font-size: 1.2rem; margin-bottom: 40px;">Interactive Genome Comparison</p></div>
            <div class="hero-animation-container" id="hero-animation"></div>
            <div class="property-circle-container">
                <div class="property-circle" id="prop-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 15C5.9 14 11 11.8 12 11c1.2-0.8 2.9-0.9 4-1.2 3.6-0.8 7-2 8-3.5"></path><path d="M22 9c-3.9 1-9 3.2-10 4s-2.9 0.9-4 1.2C4.4 15 1 16.2 0 17.5"></path><line x1="12" y1="2" x2="12" y2="22"></line><line x1="2" y1="9" x2="22" y2="15"></line><line x1="2" y1="15" x2="22" y2="9"></line></svg><h3>Double Helix</h3><p>The iconic twisted-ladder structure.</p></div>
                <div class="property-circle" id="prop-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg><h3>Genetic Blueprint</h3><p>Instructions for all known organisms.</p></div>
                <div class="property-circle" id="prop-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg><h3>Nucleobases</h3><p>Composed of A, T, C, and G building blocks.</p></div>
                <div class="property-circle" id="prop-4"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l-3-3a5 5 0 0 0-7.07-7.07L9.5 5.5"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07L14.5 18.5"></path></svg><h3>Base Pairing</h3><p>A-T and G-C connections ensure faithful replication.</p></div>
            </div>
        </section>

        <section id="features" class="container">
            <h2>Platform Architecture</h2>
            <div class="features-grid">
                 <div class="feature-card"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg><h3>Robust Backend Engine</h3><p>Built on a scalable Python and Flask foundation, ensuring reliable and efficient processing of your datasets.</p></div>
                <div class="feature-card"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20V16"></path></svg><h3>Publication-Ready Plots</h3><p>Generate high-resolution heatmaps and network graphs using Matplotlib and NetworkX, ready for your research.</p></div>
                <div class="feature-card"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 18H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h3.19M15 6h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-3.19"></path><path d="M8.63 6.37a2 2 0 1 1 3.24 2.45L6.5 12.55a2 2 0 1 1-3.24-2.45L8.63 6.37z"></path></svg><h3>Streamlined Workflow</h3><p>A clean, responsive interface designed for researchers. Upload files, set parameters, and receive results without leaving your browser.</p></div>
            </div>
        </section>

        <div class="transition-divider">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 120"><path fill="#0c121c" fill-opacity="1" d="M0,32L1440,96L1440,120L0,120Z"></path></svg>
        </div>

        <section id="tool" class="container">
            <h2>Analysis Workbench</h2>
            <div class="tool-layout">
                <aside class="tool-sidebar">
                    <h3>Controls</h3>
                    <form id="analysis-form">
                         <div class="form-group">
                            <label>1. Choose Mode</label>
                            <div class="radio-group"><input type="radio" id="pairwise" name="mode" value="Pairwise"> <label for="pairwise">Pairwise</label></div>
                            <div class="radio-group"><input type="radio" id="allvsall" name="mode" value="All vs All" checked> <label for="allvsall">All vs All</label></div>
                        </div>
                         <div class="form-group">
                            <label>2. K-mer Size (<span id="kmer-value">21</span>)</label>
                            <input type="range" id="kmer_size" name="kmer_size" min="5" max="31" value="21" step="2">
                        </div>
                        <div class="form-group">
                            <label>3. Network Threshold (<span id="threshold-value">90</span>%)</label>
                            <input type="range" id="threshold" name="threshold" min="50" max="100" value="90">
                        </div>
                        <div id="pairwise-inputs" class="form-group" style="display: none;"><label>Reference FASTA File</label><input type="file" id="reference_file" name="reference_file"><br><br><label for="query_files">Query FASTA Files</label><input type="file" id="query_files" name="query_files" multiple></div>
                        <div id="all-vs-all-inputs" class="form-group"><label>All FASTA Files</label><input type="file" id="all_files" name="all_files" multiple></div>
                        <div class="analyze-button-wrapper">
                            <button type="submit" class="btn btn-primary">Analyze Now</button>
                        </div>
                    </form>
                </aside>
                <div class="tool-main-content">
                    <div id="message-box" style="display: none; padding: 15px; border-radius: 8px; margin-bottom: 20px;"></div>
                    <div id="results-container">
                        <p class="placeholder-text">Your analysis results will appear here.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const header = document.getElementById('main-header');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 20) { header.classList.add('scrolled'); } else { header.classList.remove('scrolled'); }
            });

            const heroAnimationContainer = document.getElementById('hero-animation');
            const heroSection = document.querySelector('.hero');
            if (heroAnimationContainer) {
                const numElementsPerStrand = 40;
                const containerWidth = 600;
                const amplitude = 80;
                const colors = ['#feda75', '#fa7e1e', '#d62976', '#962fbf', '#4f5bd5'];
                for (let i = 0; i < numElementsPerStrand; i++) {
                    const xPos = (i / (numElementsPerStrand - 1)) * containerWidth - (containerWidth / 2);
                    const colorIndex = i % colors.length;
                    const element1 = document.createElement('div');
                    element1.classList.add('strand-element');
                    const yPos1 = Math.sin(xPos / 50) * amplitude;
                    element1.style.setProperty('--start-x', '-800px');
                    element1.style.setProperty('--end-x', `${xPos}px`);
                    element1.style.setProperty('--y-pos', `${yPos1}px`);
                    element1.style.setProperty('--y-oscillation', `10px`);
                    element1.style.setProperty('--delay', `${i * 0.04}s`);
                    const baseDiv = document.createElement('div');
                    baseDiv.classList.add('base');
                    baseDiv.style.backgroundColor = colors[colorIndex];
                    baseDiv.textContent = ['A', 'T', 'C', 'G'][i % 4];
                    element1.appendChild(baseDiv);
                    heroAnimationContainer.appendChild(element1);
                    const element2 = document.createElement('div');
                    element2.classList.add('strand-element');
                    const yPos2 = -Math.sin(xPos / 50) * amplitude;
                    element2.style.setProperty('--start-x', '800px');
                    element2.style.setProperty('--end-x', `${xPos}px`);
                    element2.style.setProperty('--y-pos', `${yPos2}px`);
                    element2.style.setProperty('--y-oscillation', `-10px`);
                    element2.style.setProperty('--delay', `${i * 0.04}s`);
                    const dotDiv = document.createElement('div');
                    dotDiv.classList.add('dot');
                    dotDiv.style.backgroundColor = colors[colorIndex];
                    dotDiv.style.boxShadow = `0 0 12px ${colors[colorIndex]}`;
                    element2.appendChild(dotDiv);
                    heroAnimationContainer.appendChild(element2);
                }
                setTimeout(() => { heroSection.classList.add('start-assembly'); }, 200);
                setTimeout(() => { heroSection.classList.add('show-properties'); }, 2500);
            }
            
            const form = document.getElementById('analysis-form');
            const loaderOverlay = document.getElementById('loader-overlay');
            const messageBox = document.getElementById('message-box');
            const resultsContainer = document.getElementById('results-container');
            const submitButton = form.querySelector('button');
            const modeRadios = document.querySelectorAll('input[name="mode"]');
            const pairwiseInputs = document.getElementById('pairwise-inputs');
            const allVsAllInputs = document.getElementById('all-vs-all-inputs');
            
            function toggleInputs() {
                if (document.getElementById('pairwise').checked) {
                    pairwiseInputs.style.display = 'block';
                    allVsAllInputs.style.display = 'none';
                } else {
                    pairwiseInputs.style.display = 'none';
                    allVsAllInputs.style.display = 'block';
                }
            }
            toggleInputs();
            modeRadios.forEach(radio => radio.addEventListener('change', toggleInputs));
            
            const thresholdSlider = document.getElementById('threshold');
            const thresholdValue = document.getElementById('threshold-value');
            const kmerSlider = document.getElementById('kmer_size');
            const kmerValue = document.getElementById('kmer-value');
            
            if(thresholdSlider) thresholdSlider.oninput = () => { thresholdValue.textContent = thresholdSlider.value; };
            if(kmerSlider) kmerSlider.oninput = () => { kmerValue.textContent = kmerSlider.value; };
            
            let particleInterval;

            function startLoaderAnimation() {
                const container = document.getElementById('animation-container');
                const particleTypes = [
                    { type: 'base', content: 'A', class: 'base-a' },
                    { type: 'base', content: 'T', class: 'base-t' },
                    { type: 'base', content: 'C', class: 'base-c' },
                    { type: 'base', content: 'G', class: 'base-g' },
                    { type: 'cell', content: '●', class: 'cell-red' },
                    { type: 'cell', content: '✧', class: 'cell-neuron' }
                ];

                particleInterval = setInterval(() => {
                    const particleData = particleTypes[Math.floor(Math.random() * particleTypes.length)];
                    const particle = document.createElement('div');
                    
                    particle.className = `particle ${particleData.class}`;
                    if (particleData.type === 'base') {
                        particle.classList.add('base');
                    } else {
                        particle.classList.add('cell');
                    }
                    particle.textContent = particleData.content;
                    
                    particle.style.top = `${Math.random() * 60 + 20}%`;
                    const duration = Math.random() * 2 + 3;
                    particle.style.animationDuration = `${duration}s`;

                    container.appendChild(particle);

                    setTimeout(() => {
                        particle.remove();
                    }, duration * 1000);

                }, 150);
            }

            function stopLoaderAnimation() {
                clearInterval(particleInterval);
                const container = document.getElementById('animation-container');
                if(container) {
                    container.innerHTML = '<div class="data-stream"></div>';
                }
            }

            if(form) {
                form.addEventListener('submit', function(event) {
                    event.preventDefault();
                    loaderOverlay.style.display = 'flex';
                    startLoaderAnimation();
                    submitButton.disabled = true;
                    messageBox.style.display = 'none';
                    resultsContainer.innerHTML = '';

                    const formData = new FormData(form);

                    fetch('/analyze', { method: 'POST', body: formData })
                    .then(response => {
                        if (!response.ok) { return response.json().then(err => {throw new Error(err.message || 'Server returned an error')}); }
                        return response.json();
                    })
                    .then(data => {
                         if (data.status === 'success') {
                            messageBox.textContent = 'Analysis successful!';
                            messageBox.className = 'success';
                            if (data.table_data && data.table_data.length > 0) {
                                const tableContainer = document.createElement('div');
                                tableContainer.className = 'table-container';
                                const table = document.createElement('table');
                                table.className = 'results-table';
                                const thead = table.createTHead();
                                const headerRow = thead.insertRow();
                                const headers = Object.keys(data.table_data[0]);
                                headers.forEach(key => {
                                    const th = document.createElement('th');
                                    th.textContent = key;
                                    headerRow.appendChild(th);
                                });
                                const tbody = table.createTBody();
                                data.table_data.forEach(rowData => {
                                    const row = tbody.insertRow();
                                    headers.forEach(header => {
                                        const cell = row.insertCell();
                                        cell.textContent = rowData[header];
                                    });
                                });
                                tableContainer.appendChild(table);
                                resultsContainer.appendChild(tableContainer);
                            }
                            if (data.download_links && Object.keys(data.download_links).length > 0) {
                                const linksContainer = document.createElement('div');
                                linksContainer.className = 'download-links-container';
                                linksContainer.appendChild(document.createElement('h3')).textContent = 'Download Visualizations';
                                for (const key in data.download_links) {
                                    const link = document.createElement('a');
                                    link.href = data.download_links[key];
                                    link.textContent = `Download ${key.charAt(0).toUpperCase() + key.slice(1)}`;
                                    link.setAttribute('download', '');
                                    link.setAttribute('target', 'blank');
                                    linksContainer.appendChild(link);
                                }
                                resultsContainer.appendChild(linksContainer);
                            }
                        } else { throw new Error(data.message || 'An unknown error occurred.'); }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        messageBox.textContent = 'Error: ' + error.message;
                        messageBox.className = 'error';
                    })
                    .finally(() => {
                        messageBox.style.display = 'block';
                        submitButton.disabled = false;
                        loaderOverlay.style.display = 'none';
                        stopLoaderAnimation();
                    });
                });
            }
        });
    </script>
</body>
</html>
